# DigitalOcean Schema Generator Prompt

## Context
You are generating PropBuilder-based schemas for DigitalOcean API resources. Use the DigitalOcean API specification (`digitalocean-api-spec.yaml`) and follow the established patterns from the AWS EC2 Instance reference schema generated by `si_auth.py`.

## Instructions

Generate a complete PropBuilder schema for the DigitalOcean resource: `{RESOURCE_NAME}`

### Required Steps:
1. **Extract Schema Definition**: Search for the creation schema in `digitalocean-api-spec.yaml` using patterns like:
   - `{resource_name}_create:`
   - `{resource_name}_single_create:`
   - `{resource_name}:` (for base schemas)

2. **Generate PropBuilder Schema** following these patterns:

### Property Type Mappings:
- **String properties** → `setKind("string")`
- **Integer properties** → `setKind("float")` + `setValidationFormat(Joi.number().integer())`
- **Boolean properties** → `setKind("boolean")`
- **Array properties** → `setKind("array")` + `setEntry()` for items
- **Object properties** → `setKind("object")` + `addChild()` for nested props

### Widget Type Mappings:
- **Enums/Limited Options** → `setKind("comboBox")` + `addOption(value, label)`
- **Text input** → `setKind("text")`
- **Boolean** → `setKind("checkbox")`
- **Arrays** → `setKind("array")`
- **Objects** → `setKind("header")`
- **Code/Scripts** → `setKind("codeEditor")`
- **Large text** → `setKind("textArea")`

### Validation Patterns:
- **Required fields** → `setValidationFormat(Joi.string().required())`
- **String length** → `Joi.string().max(255)`
- **Patterns** → `Joi.string().pattern(/regex/)`
- **UUIDs** → `Joi.string().uuid()`
- **Numbers** → `Joi.number().integer().min(0).max(100)`
- **Arrays** → Apply validation to entry items

### Common DigitalOcean Property Patterns:

#### Regions:
```javascript
.setWidget(new PropWidgetDefinitionBuilder()
    .setKind("comboBox")
    .addOption("nyc1", "New York 1")
    .addOption("nyc3", "New York 3")
    .addOption("ams3", "Amsterdam 3")
    .addOption("sfo3", "San Francisco 3")
    .addOption("sgp1", "Singapore 1")
    .addOption("lon1", "London 1")
    .addOption("fra1", "Frankfurt 1")
    .addOption("tor1", "Toronto 1")
    .addOption("blr1", "Bangalore 1")
    .setCreateOnly()
    .build())
```

#### Names with DO Pattern:
```javascript
.setValidationFormat(Joi.string().required().max(255).pattern(/^[a-zA-Z0-9]?[a-z0-9A-Z.\-]*[a-z0-9A-Z]$/))
```

#### Tags Array:
```javascript
.setKind("array")
.setEntry(
    new PropBuilder()
    .setName("tags_item")
    .setKind("string")
    .setWidget(new PropWidgetDefinitionBuilder().setKind("text").build())
    .build()
)
```

#### SSH Keys Array:
```javascript
.setKind("array")
.setValidationFormat(Joi.alternatives().try(Joi.number().integer(), Joi.string()))
.setEntry(
    new PropBuilder()
    .setName("ssh_keys_item")
    .setKind("string")
    .setWidget(new PropWidgetDefinitionBuilder().setKind("text").build())
    .setDocumentation("SSH key ID (integer) or fingerprint (string)")
    .build()
)
```

### Schema Structure Template:
```javascript
function main() {
    // Props - Generate one for each property
    const {propertyName}Prop = new PropBuilder()
        .setName("{property_name}")
        .setKind("{data_type}")
        .setHidden(false)
        .setWidget(new PropWidgetDefinitionBuilder()
            .setKind("{widget_type}")
            .setCreateOnly() // For creation-only properties
            .build())
        .setValidationFormat({validation_rules})
        .setDocumentation("{property_description_from_api_spec}")
        .build();

    // For objects with nested properties:
    const nestedProp = new PropBuilder()
        .setName("nested_object")
        .setKind("object")
        .setWidget(new PropWidgetDefinitionBuilder().setKind("header").build())
        .addChild(/* child props */)
        .build();

    // Create the asset
    const asset = new AssetBuilder()
        .addProp(/* all props */)
        .build();

    return asset;
}
```

### Specific Requirements:
- **CreateOnly**: Mark creation-only properties with `.setCreateOnly()`
- **Required Properties**: Use `Joi.string().required()` for mandatory fields
- **Documentation**: Extract description from API spec and use exact text
- **Naming**: Use DigitalOcean's native property names (no AWS-style conversion)
- **Service Mapping**: Map to appropriate DO service namespace:
  - Droplets → `DigitalOcean::Compute::Droplet`
  - Volumes → `DigitalOcean::Storage::Volume`
  - LoadBalancers → `DigitalOcean::Networking::LoadBalancer`
  - Databases → `DigitalOcean::Database::{Engine}`
  - Kubernetes → `DigitalOcean::Container::Cluster`

### Output Format:
Write the complete schema to a file named: `{resource-name}-schema.js`

### Resource-Specific Notes:
- **Droplets**: Include size options, image options, region options
- **Volumes**: Include filesystem types, size constraints
- **LoadBalancers**: Include algorithm options, health check configs
- **Databases**: Include engine versions, node sizes, backup configs
- **VPCs**: Include IP range validation
- **Firewalls**: Include port ranges, protocol options

### DigitalOcean Credential Component:

Create a credential component to allow other components to subscribe to the secret in order to make calls to the DigitalOcean API. Use this pattern:

#### Credential Schema
```typescript
function main() {
    const doCredential = new SecretDefinitionBuilder()
        .setName("DigitalOcean Credential")
        .addProp(
            new PropBuilder()
            .setName("ApiToken")
            .setKind("string")
            .setWidget(
                new PropWidgetDefinitionBuilder()
                .setKind("password")
                .build()
            ).build())
        .build();
    return new AssetBuilder()
        .defineSecret(doCredential)
        .build()
}
```

#### Authentication Function
```typescript
async function main(secret: Input): Promise<Output> {
    // Store the DO API token in request storage for use by other functions
    requestStorage.setEnv("DO_API_TOKEN", secret.ApiToken);
}
```

### DigitalOcean API Access Example:

Use this fetch function to access the DigitalOcean API with the `DO_API_TOKEN` environment variable:

```typescript
// Simple DigitalOcean API fetch function using environment variable
async function doApiFetch(endpoint: string, options: RequestInit = {}) {
  const token = requestStorage.getEnv("DO_API_TOKEN");
  if (!token) {
    throw new Error('DO_API_TOKEN not found (hint: you may need a secret)');
  }

  const response = await fetch(`https://api.digitalocean.com/v2${endpoint}`, {
    headers: {
      'Authorization': `Bearer ${token}`,
      'Content-Type': 'application/json',
    },
  });

  if (!response.ok) {
    throw new Error(`API Error: ${response.status} ${response.statusText}`);
  }

  return response.json();
}

// Example usages:
const droplets = await doApiFetch('/droplets');
const regions = await doApiFetch('/regions');
const newDroplet = await doApiFetch('/droplets', {
  method: 'POST',
  body: JSON.stringify({
    name: 'my-droplet',
    region: 'nyc3',
    size: 's-1vcpu-1gb',
    image: 'ubuntu-20-04-x64'
  })
});
```

Generate the complete schema now for: `{RESOURCE_NAME}`
